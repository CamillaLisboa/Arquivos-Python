{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>Novo evento</h2>
  <form action="{{ url_for('add_event') }}" method="post" class="grid">
    <div class="form-group">
      <label for="title">TÃ­tulo</label>
      <input type="text" id="title" name="title" placeholder="CafÃ© da manhÃ£" />
    </div>
    <div class="form-group">
      <label for="date">Data</label>
      <input type="date" id="date" name="date" required />
    </div>
    <div class="form-group full">
      <button type="submit" class="btn">Criar evento</button>
    </div>
  </form>
</section>

{% for e in events %}
  <section class="card">
    <div class="card-header">
      <div>
        <h3>{{ e.title }}</h3>
        <p class="muted">Data: {{ e.date }}</p>
      </div>
      <form action="{{ url_for('delete_event') }}" method="post" style="display:flex; gap:8px; align-items:center;">
        <a class="btn ghost" href="{{ url_for('edit_event', event_id=e.id) }}">Editar</a>
        <input type="hidden" name="event_id" value="{{ e.id }}">
        <button class="btn danger" onclick="return confirm('Excluir este evento?')">Excluir</button>
      </form>
    </div>

    <div class="list">
      {% if e.participations %}
        {% for p in e.participations %}
          <div class="list-row">
            <div class="chip">{{ p.student_name }}</div>
            <div class="muted">Vai trazer: <strong>{{ p.item }}</strong></div>
            <form action="{{ url_for('delete_participation') }}" method="post" style="display:flex; gap:8px; align-items:center;">
              <a class="btn ghost" href="{{ url_for('edit_participation', pid=p.id) }}">editar</a>
              <input type="hidden" name="participation_id" value="{{ p.id }}">
              <button class="btn ghost">remover</button>
            </form>
          </div>
        {% endfor %}
      {% else %}
        <p class="muted">Ainda sem participantes. Adicione abaixo ðŸ‘‡</p>
      {% endif %}
    </div>

    <form action="{{ url_for('add_participant') }}" method="post" class="grid compact">
      <input type="hidden" name="event_id" value="{{ e.id }}">
      <div class="form-group">
        <label for="name-{{ e.id }}">Aluno</label>
        <input type="text" id="name-{{ e.id }}" name="name" placeholder="Nome do aluno" required>
      </div>
      <div class="form-group">
        <label for="item-{{ e.id }}">O que vai trazer</label>
        <input type="text" id="item-{{ e.id }}" name="item" placeholder="Ex: suco, pÃ£o de queijo" required>
      </div>
      <div class="form-group">
        <label for="contact-{{ e.id }}">Contato (opcional)</label>
        <input type="text" id="contact-{{ e.id }}" name="contact" placeholder="@instagram, telefone...">
      </div>
      <div class="form-group full">
        <button type="submit" class="btn">Adicionar participante</button>
      </div>
    </form>
  </section>
{% endfor %}

{% if not events %}
  <p class="muted center">Nenhum evento ainda. Crie o primeiro acima âœ¨</p>
{% endif %}
{% endblock %}
